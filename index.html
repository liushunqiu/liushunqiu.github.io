<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>路一直都在丶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="路一直都在丶">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="路一直都在丶">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="路一直都在丶">
  
    <link rel="alternate" href="/atom.xml" title="路一直都在丶" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">路一直都在丶</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-深入理解HashMap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/09/深入理解HashMap/" class="article-date">
  <time datetime="2018-08-09T09:32:54.000Z" itemprop="datePublished">2018-08-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/09/深入理解HashMap/">深入理解HashMap</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">推荐阅读 https:<span class="comment">//zhuanlan.zhihu.com/p/21673805</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>hash方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>put方法流程<br><img src="/images/HashMap的putVal方法.png" alt=""></p>
</li>
<li>resize流程<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">     Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">     <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">     <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">     <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">// 超过最大值就不再扩充了，就只好随你碰撞去吧</span></span><br><span class="line">         <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">             threshold = Integer.MAX_VALUE;</span><br><span class="line">             <span class="keyword">return</span> oldTab;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 没超过最大值，就扩充为原来的2倍</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                  oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">             newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">         newCap = oldThr;</span><br><span class="line">     <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">         newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">         newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// 计算新的resize上限</span></span><br><span class="line">     <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line"> </span><br><span class="line">         <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">         newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                   (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">     &#125;</span><br><span class="line">     threshold = newThr;</span><br><span class="line">     <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>，<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">         Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">     table = newTab;</span><br><span class="line">     <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="comment">// 把每个bucket都移动到新的buckets中</span></span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">             Node&lt;K,V&gt; e;</span><br><span class="line">             <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                 oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                 <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                     newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                 <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                     ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                 <span class="keyword">else</span> &#123; <span class="comment">// 链表优化重hash的代码块</span></span><br><span class="line">                     Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                     Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                     Node&lt;K,V&gt; next;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                         next = e.next;</span><br><span class="line">                         <span class="comment">// 原索引</span></span><br><span class="line">                         <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                             <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                 loHead = e;</span><br><span class="line">                             <span class="keyword">else</span></span><br><span class="line">                                 loTail.next = e;</span><br><span class="line">                             loTail = e;</span><br><span class="line">                         &#125;</span><br><span class="line">                         <span class="comment">// 原索引+oldCap</span></span><br><span class="line">                         <span class="keyword">else</span> &#123;</span><br><span class="line">                             <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                 hiHead = e;</span><br><span class="line">                             <span class="keyword">else</span></span><br><span class="line">                                 hiTail.next = e;</span><br><span class="line">                             hiTail = e;</span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                     <span class="comment">// 原索引放到bucket里</span></span><br><span class="line">                     <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                         loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                         newTab[j] = loHead;</span><br><span class="line">                     &#125;</span><br><span class="line">                     <span class="comment">// 原索引+oldCap放到bucket里</span></span><br><span class="line">                     <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                         hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                         newTab[j + oldCap] = hiHead;</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> newTab;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/09/深入理解HashMap/" data-id="cjkp8jblh000fo4qf2wf5rpaa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java虚拟机命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/29/Java虚拟机命令/" class="article-date">
  <time datetime="2018-07-29T05:25:23.000Z" itemprop="datePublished">2018-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/29/Java虚拟机命令/">Java虚拟机命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p><code>jps：虚拟机进程状况工具</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a). -l 输出主类的全名,如果进程执行的是Jar包,输出Jar路径</span><br><span class="line">b). -m 输出虚拟机进程启动时传递给主类main()函数的参数</span><br><span class="line">c). -v 输出虚拟机进程启动时传入JVM参数</span><br><span class="line">eg: jps -lvm </span><br><span class="line">--------------------------</span><br><span class="line"><span class="number">24131</span> sun.tools.jps.Jps -lmv -Dapplication.home=/usr/java/jdk1.8.0_101 -Xms8m</span><br><span class="line"><span class="number">1541</span> /data/webdata/apps<span class="comment">//search.jar -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=9960,suspend=n -Xms128M -Xmx256M -Dspring.profiles.active=dev</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>jstat：虚拟机统计信息监视工具</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">a). -<span class="class"><span class="keyword">class</span> 监视类装载、卸载数量、总空间以及类装在所消耗的时间</span></span><br><span class="line">eg: jstat -class 19830</span><br><span class="line">Loaded(加载<span class="class"><span class="keyword">class</span>的数量)       <span class="title">Bytes</span>(所占用空间大小)      <span class="title">Unloaded</span>(未加载数量)  <span class="title">Bytes</span>(未加载占用空间)   <span class="title">Time</span>(时间) </span></span><br><span class="line"><span class="class">          8594                      15920.9                   0                      0.0             11.40</span></span><br><span class="line"><span class="class">------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="class"><span class="title">b</span>). -<span class="title">gc</span> 监视<span class="title">Java</span>堆状态,包括<span class="title">Eden</span>区、两个<span class="title">survivor</span>区、老年代、永久代等的容量、已用空间、<span class="title">GC</span>时间合计等信息</span></span><br><span class="line">eg: jstat -gc 19830</span><br><span class="line">S0C(第一个幸存区的大小)    S1C(第二个幸存区的大小)    S0U(第一个幸存区的使用大小)    S1U(第二个幸存区的使用大小)      EC(伊甸园区的大小)       EU(伊甸园区的使用大小)        OC(老年代大小)         OU(老年代使用大小)       MC(方法区大小)     MU(方法区使用大小)    CCSC(压缩类空间大小)   CCSU(压缩类空间使用大小)   YGC(年轻代垃圾回收次数)     YGCT(年轻代垃圾回收消耗时间)    FGC(老年代垃圾回收次数)    FGCT(老年代垃圾回收消耗时间)     GCT(垃圾回收消耗总时间)   </span><br><span class="line">        <span class="number">8192.0</span>             	<span class="number">1536.0</span>      		  <span class="number">0.0</span>  			 <span class="number">1184.2</span> 		  <span class="number">122880.0</span>		   <span class="number">48794.8</span>   		    <span class="number">175104.0</span>  		 <span class="number">28093.7</span>   	       <span class="number">47656.0</span> 		  <span class="number">46746.4</span> 		<span class="number">5928.0</span> 		   <span class="number">5718.4</span>     		   <span class="number">27</span>    			<span class="number">0.383</span>  			 <span class="number">2</span>     		 	<span class="number">0.299</span>    			<span class="number">0.682</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">c). -gccapacity 监视内容与-gc基本相同,但输出主要关注Java堆各个区域使用到的最大、最小空间</span><br><span class="line">eg: jstat -gccapacity <span class="number">19830</span></span><br><span class="line"> NGCMN(新生代最小容量)    NGCMX(新生代最大容量)     NGC(当前新生代容量)     S0C(第一个幸存区的大小)   S1C(第二个幸存区的大小)       EC(伊甸园区的大小)       OGCMN(老年代最小容量)      OGCMX(老年代最大容量)       OGC(老年代容量当前新生成的容量)         OC(老年代大小)       MCMN(方法区最小容量)     MCMX(方法区最大容量)      MC(方法区大小)     CCSMN(最小压缩类空间大小)    CCSMX(最大压缩类空间大小)     CCSC(压缩类空间大小)    YGC(年轻代垃圾回收次数)    FGC(老年代垃圾回收次数) </span><br><span class="line"> 	<span class="number">87040.0</span> 		<span class="number">174592.0</span> 		<span class="number">139264.0</span> 		<span class="number">8192.0</span> 		<span class="number">1536.0</span> 			<span class="number">122880.0</span>   		<span class="number">175104.0</span> 		  <span class="number">349696.0</span>  			 <span class="number">175104.0</span>  		 	<span class="number">175104.0</span>     		 <span class="number">0.0</span> 		<span class="number">1091584.0</span> 		 <span class="number">47656.0</span>     		 <span class="number">0.0</span> 		<span class="number">1048576.0</span>  			 <span class="number">5928.0</span>    		 <span class="number">27</span>   		  <span class="number">2</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">d). -gcutil 监视内容与-gc基本相同,但输出主要关注已使用空间占总空间的百分比</span><br><span class="line">eg: jstat -gcutil <span class="number">19830</span></span><br><span class="line">  S0(第一个幸存区当前使用比例)     S1(第二个幸存区当前使用比例)     E(伊甸园区使用比例)      O(老年代区使用比例)      M(方法区使用比例)     CCS(压缩使用比例)    YGC(年轻代垃圾回收次数)     YGCT(年轻代垃圾回收消耗时间)    FGC(老年代垃圾回收次数)    FGCT(老年代垃圾回收消耗时间)     GCT(垃圾回收消耗总时间)   </span><br><span class="line">  	<span class="number">0.00</span> 		 	   <span class="number">77.09</span>  			<span class="number">51.17</span> 		 	<span class="number">16.04</span>  			<span class="number">98.09</span> 		 <span class="number">96.46</span>  		   <span class="number">27</span>   		 <span class="number">0.383</span>    		 <span class="number">2</span>  		  		<span class="number">0.299</span> 		  	 <span class="number">0.682</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">e). -gccause 与 -gcutil 功能一样,但是会额外输出导致上一次GC产生的原因</span><br><span class="line">eg: jstat -gccause <span class="number">19830</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">f). -gcnew 监视新生代GC状况</span><br><span class="line">eg: jstat -gcnew <span class="number">19830</span></span><br><span class="line"> S0C(第一个幸存区的大小)    S1C(第二个幸存区的大小)    S0U(第一个幸存区的使用大小)    S1U(第二个幸存区的使用大小)   TT(对象在新生代存活的次数) MTT(对象在新生代存活的最大次数)  DSS(期望的幸存区大小)      EC(伊甸园区的大小)       EU(伊甸园区的使用大小)     YGC(年轻代垃圾回收次数)     YGCT(年轻代垃圾回收消耗时间)  </span><br><span class="line">	<span class="number">8192.0</span> 			<span class="number">1536.0</span>    			<span class="number">0.0</span> 			<span class="number">1184.2</span> 			<span class="number">13</span>  			<span class="number">15</span> 			<span class="number">8192.0</span> 				<span class="number">122880.0</span> 		 <span class="number">67585.5</span> 		    <span class="number">27</span>   		 <span class="number">0.383</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">g). -gcnewcapacity 监视内容与 -gcnew 基本相同,输出主要关注使用到的最大、最小空间</span><br><span class="line">eg: jstat -gcnewcapacity <span class="number">19830</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">h). -gcold 监视老年代GC情况</span><br><span class="line">eg: jstat -gcold <span class="number">19830</span></span><br><span class="line">   MC(方法区大小)      MU(方法区使用大小)      CCSC(压缩类空间大小)     CCSU(压缩类空间使用大小)       OC(老年代大小)          OU(老年代使用大小)       YGC(年轻代垃圾回收次数)    FGC(老年代垃圾回收次数)    FGCT(老年代垃圾回收消耗时间)     GCT(垃圾回收消耗总时间)   </span><br><span class="line">    <span class="number">47656.0</span>		  <span class="number">46746.4</span>  		 <span class="number">5928.0</span>   		<span class="number">5718.4</span>   		 <span class="number">175104.0</span>   		  <span class="number">28093.7</span>  		   <span class="number">27</span>    		 <span class="number">2</span>   		 	<span class="number">0.299</span> 		  	 <span class="number">0.682</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">i). -compiler 输出JIT编译器编译过的方法、耗时等信息</span><br><span class="line">eg： jstat -compiler <span class="number">19830</span></span><br><span class="line">Compiled(编译数量) Failed(失败数量) Invalid(不可用数量)   Time(时间)   FailedType(失败类型) FailedMethod(失败的方法)</span><br><span class="line">    <span class="number">6788</span>     	 	<span class="number">1</span>       	<span class="number">0</span>  		 <span class="number">53.83</span>         	 <span class="number">1</span> 	org/springframework/core/annotation/AnnotationUtils 		findAnnotation</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>jinfo：Java配置信息工具</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">实时的查看和调整虚拟机各项参数</span><br><span class="line">eg: jinfo [options] [pid]</span><br><span class="line">Usage:</span><br><span class="line">    jinfo [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jinfo [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jinfo [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br><span class="line"></span><br><span class="line">where &lt;option&gt; is one of:</span><br><span class="line">    -flag &lt;name&gt;         to print the value of the named VM flag</span><br><span class="line">    -flag [+|-]&lt;name&gt;    to enable or disable the named VM flag</span><br><span class="line">    -flag &lt;name&gt;=&lt;value&gt; to set the named VM flag to the given value</span><br><span class="line">    -flags               to print VM flags</span><br><span class="line">    -sysprops            to print Java system properties</span><br><span class="line">    &lt;no option&gt;          to print both of the above</span><br><span class="line">    -h | -help           to print <span class="keyword">this</span> help message</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>jmap:Java内存映像工具</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">    jmap [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jmap [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jmap [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br><span class="line"></span><br><span class="line">where &lt;option&gt; is one of:</span><br><span class="line">    &lt;none&gt;               to print same info as Solaris pmap</span><br><span class="line">    -heap                to print java heap summary</span><br><span class="line">    -histo[:live]        to print histogram of java object heap; <span class="keyword">if</span> the <span class="string">"live"</span></span><br><span class="line">                         suboption is specified, only count live objects</span><br><span class="line">    -clstats             to print <span class="class"><span class="keyword">class</span> <span class="title">loader</span> <span class="title">statistics</span></span></span><br><span class="line"><span class="class">    -<span class="title">finalizerinfo</span>       <span class="title">to</span> <span class="title">print</span> <span class="title">information</span> <span class="title">on</span> <span class="title">objects</span> <span class="title">awaiting</span> <span class="title">finalization</span></span></span><br><span class="line">    -dump:&lt;dump-options&gt; to dump java heap in hprof binary format</span><br><span class="line">                         dump-options:</span><br><span class="line">                           live         dump only live objects; <span class="keyword">if</span> not specified,</span><br><span class="line">                                        all objects in the heap are dumped.</span><br><span class="line">                           format=b     binary format</span><br><span class="line">                           file=&lt;file&gt;  dump heap to &lt;file&gt;</span><br><span class="line">                         Example: jmap -dump:live,format=b,file=heap.bin &lt;pid&gt;</span><br><span class="line">    -F                   force. Use with -dump:&lt;dump-options&gt; &lt;pid&gt; or -histo</span><br><span class="line">                         to force a heap dump or histogram when &lt;pid&gt; does not</span><br><span class="line">                         respond. The <span class="string">"live"</span> suboption is not supported</span><br><span class="line">                         in <span class="keyword">this</span> mode.</span><br><span class="line">    -h | -help           to print <span class="keyword">this</span> help message</span><br><span class="line">    -J&lt;flag&gt;             to pass &lt;flag&gt; directly to the runtime system</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eg: jmap -dump:format=b,file=/root/dump.bin <span class="number">19830</span></span><br><span class="line">Dumping heap to /root/dump.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure>
<ol start="5">
<li><p><code>jhat:虚拟机堆转储快照分析工具</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jhat dump.bin</span><br><span class="line">Reading from dump.bin...</span><br><span class="line">Dump file created Sun Jul <span class="number">29</span> <span class="number">19</span>:<span class="number">56</span>:<span class="number">51</span> CST <span class="number">2018</span></span><br><span class="line">Snapshot read, resolving...</span><br><span class="line">Resolving <span class="number">592589</span> objects...</span><br><span class="line">Chasing references, expect <span class="number">118</span> dots......................................................................................................................</span><br><span class="line">Eliminating duplicate references......................................................................................................................</span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP server on port <span class="number">7000</span></span><br><span class="line">Server is ready.</span><br><span class="line">通常使用VisualVM去分析jmap dump下来的bin文件</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>jstack:Java堆栈跟踪工具</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">jstack 用于生成虚拟机当前时刻的线程快照</span><br><span class="line">Usage:</span><br><span class="line">    jstack [-l] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jstack -F [-m] [-l] &lt;pid&gt;</span><br><span class="line">        (to connect to a hung process)</span><br><span class="line">    jstack [-m] [-l] &lt;executable&gt; &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jstack [-m] [-l] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to a remote debug server)</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -F  to force a thread dump. Use when jstack &lt;pid&gt; does not respond (process is hung)</span><br><span class="line">    -m  to print both java and native frames (mixed mode)</span><br><span class="line">    -l  long listing. Prints additional information about locks</span><br><span class="line">    -h or -help to print this help message</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/29/Java虚拟机命令/" data-id="cjkp8jblc0008o4qfrk5gs1c2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java虚拟机/">Java虚拟机</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-记一次MySQL死锁问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/07/记一次MySQL死锁问题/" class="article-date">
  <time datetime="2018-07-07T07:35:57.000Z" itemprop="datePublished">2018-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/07/记一次MySQL死锁问题/">记一次MySQL死锁问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>登陆MySQL <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mysql -u root -p</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>2.执行 show engine innodb status \G;<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">  Type: InnoDB</span><br><span class="line">  Name: </span><br><span class="line">Status: </span><br><span class="line">=====================================</span><br><span class="line">2018-07-07 14:15:27 7ff21aefb700 INNODB MONITOR OUTPUT</span><br><span class="line">=====================================</span><br><span class="line">Per second averages calculated from the last 18 seconds</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">BACKGROUND THREAD</span><br><span class="line"><span class="comment">-----------------</span></span><br><span class="line">srv_master_thread loops: 1026480 srv_active, 0 srv_shutdown, 7269604 srv_idle</span><br><span class="line">srv_master_thread log <span class="keyword">flush</span> <span class="keyword">and</span> writes: <span class="number">7531464</span></span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">SEMAPHORES</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">OS <span class="keyword">WAIT</span> <span class="built_in">ARRAY</span> INFO: reservation <span class="keyword">count</span> <span class="number">1061681</span></span><br><span class="line">OS <span class="keyword">WAIT</span> <span class="built_in">ARRAY</span> INFO: signal <span class="keyword">count</span> <span class="number">1022743</span></span><br><span class="line"><span class="keyword">Mutex</span> spin waits <span class="number">409630</span>, rounds <span class="number">2859361</span>, OS waits <span class="number">83143</span></span><br><span class="line">RW-<span class="keyword">shared</span> spins <span class="number">986199</span>, rounds <span class="number">29173618</span>, OS waits <span class="number">969842</span></span><br><span class="line">RW-excl spins <span class="number">12534</span>, rounds <span class="number">393908</span>, OS waits <span class="number">7684</span></span><br><span class="line">Spin rounds per <span class="keyword">wait</span>: <span class="number">6.98</span> <span class="keyword">mutex</span>, <span class="number">29.58</span> RW-<span class="keyword">shared</span>, <span class="number">31.43</span> RW-excl</span><br><span class="line"><span class="comment">------------------------</span></span><br><span class="line">LATEST DETECTED DEADLOCK</span><br><span class="line"><span class="comment">------------------------</span></span><br><span class="line"><span class="number">2018</span><span class="number">-07</span><span class="number">-07</span> <span class="number">14</span>:<span class="number">15</span>:<span class="number">02</span> <span class="number">7</span>ff21a1c7700</span><br><span class="line">*** (<span class="number">1</span>) <span class="keyword">TRANSACTION</span>:</span><br><span class="line"><span class="keyword">TRANSACTION</span> <span class="number">111780444</span>, ACTIVE <span class="number">12</span> sec inserting</span><br><span class="line">mysql <span class="keyword">tables</span> <span class="keyword">in</span> <span class="keyword">use</span> <span class="number">1</span>, <span class="keyword">locked</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">LOCK</span> <span class="keyword">WAIT</span> <span class="number">5</span> <span class="keyword">lock</span> <span class="keyword">struct</span>(s), <span class="keyword">heap</span> <span class="keyword">size</span> <span class="number">1184</span>, <span class="number">3</span> <span class="keyword">row</span> <span class="keyword">lock</span>(s), <span class="keyword">undo</span> <span class="keyword">log</span> entries <span class="number">1</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62038</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b491700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117199921</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root <span class="keyword">update</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">IGNORE</span> <span class="keyword">INTO</span> t_account_yxt_ecp (bid,uid,ecp,yxt,batch,<span class="string">`day`</span>,ctime)</span><br><span class="line">        <span class="keyword">VALUES</span></span><br><span class="line">          </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">107072</span>,<span class="number">0.6863</span>,<span class="number">0.00000020</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">107440</span>,<span class="number">1.4310</span>,<span class="number">0.00000054</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">109510</span>,<span class="number">0.1000</span>,<span class="number">0.00000005</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">105845</span>,<span class="number">0.1000</span>,<span class="number">0.00000003</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">105782</span>,<span class="number">9999.9991</span>,<span class="number">0.00374499</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">107050</span>,<span class="number">1.5410</span>,<span class="number">0.00000034</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">107386</span>,<span class="number">33.3100</span>,<span class="number">0.00001114</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">107322</span>,<span class="number">0.1000</span>,<span class="number">0.00000002</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">110046</span>,<span class="number">0.2420</span>,<span class="number">0.00000009</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw'</span>,<span class="number">110072</span>,<span class="number">100.3447</span>,<span class="number">0.00003163</span>,<span class="string">'892332'</span>,<span class="number">20180705</span>,<span class="keyword">now</span>())</span><br><span class="line">         , </span><br><span class="line">            (<span class="string">'yw</span></span><br><span class="line"><span class="string">*** (1) WAITING FOR THIS LOCK TO BE GRANTED:</span></span><br><span class="line"><span class="string">RECORD LOCKS space id 4122 page no 4 n bits 144 index `bid` of table `yunzz_agent`.`t_account_yxt_ecp` trx id 111780444 lock_mode X locks gap before rec insert intention waiting</span></span><br><span class="line"><span class="string">Record lock, heap no 44 PHYSICAL RECORD: n_fields 4; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 2; hex 7977; asc yw;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 8133eee1; asc  3  ;;</span></span><br><span class="line"><span class="string"> 2: len 4; hex 8001ee51; asc    Q;;</span></span><br><span class="line"><span class="string"> 3: len 4; hex 0000032a; asc    *;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** (2) TRANSACTION:</span></span><br><span class="line"><span class="string">TRANSACTION 111780445, ACTIVE 11 sec inserting</span></span><br><span class="line"><span class="string">mysql tables in use 1, locked 1</span></span><br><span class="line"><span class="string">5 lock struct(s), heap size 1184, 3 row lock(s), undo log entries 1</span></span><br><span class="line"><span class="string">MySQL thread id 62000, OS thread handle 0x7ff21a1c7700, query id 117199924 iZwz9bopxrlqc7mv1cqc0gZ 120.78.205.38 root update</span></span><br><span class="line"><span class="string">INSERT IGNORE INTO t_account_yxt_ecp (bid,uid,ecp,yxt,batch,`day`,ctime)</span></span><br><span class="line"><span class="string">        VALUES</span></span><br><span class="line"><span class="string">          </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',107072,0.6863,0.00000020,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',107440,1.4310,0.00000054,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',109510,0.1000,0.00000005,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',105845,0.1000,0.00000003,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',105782,9999.9991,0.00374499,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',107050,1.5410,0.00000034,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',107386,33.3100,0.00001114,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',107322,0.1000,0.00000002,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',110046,0.2420,0.00000009,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">         , </span></span><br><span class="line"><span class="string">            ('</span>yw<span class="string">',110072,100.3447,0.00003163,'</span><span class="number">936595</span><span class="string">',20180705,now())</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">*** (2) HOLDS THE LOCK(S):</span></span><br><span class="line"><span class="string">RECORD LOCKS space id 4122 page no 4 n bits 144 index `bid` of table `yunzz_agent`.`t_account_yxt_ecp` trx id 111780445 lock mode S locks gap before rec</span></span><br><span class="line"><span class="string">Record lock, heap no 44 PHYSICAL RECORD: n_fields 4; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 2; hex 7977; asc yw;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 8133eee1; asc  3  ;;</span></span><br><span class="line"><span class="string"> 2: len 4; hex 8001ee51; asc    Q;;</span></span><br><span class="line"><span class="string"> 3: len 4; hex 0000032a; asc    *;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** (2) WAITING FOR THIS LOCK TO BE GRANTED:</span></span><br><span class="line"><span class="string">RECORD LOCKS space id 4122 page no 4 n bits 144 index `bid` of table `yunzz_agent`.`t_account_yxt_ecp` trx id 111780445 lock_mode X locks gap before rec insert intention waiting</span></span><br><span class="line"><span class="string">Record lock, heap no 44 PHYSICAL RECORD: n_fields 4; compact format; info bits 0</span></span><br><span class="line"><span class="string"> 0: len 2; hex 7977; asc yw;;</span></span><br><span class="line"><span class="string"> 1: len 4; hex 8133eee1; asc  3  ;;</span></span><br><span class="line"><span class="string"> 2: len 4; hex 8001ee51; asc    Q;;</span></span><br><span class="line"><span class="string"> 3: len 4; hex 0000032a; asc    *;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** WE ROLL BACK TRANSACTION (2)</span></span><br><span class="line"><span class="string">------------</span></span><br><span class="line"><span class="string">TRANSACTIONS</span></span><br><span class="line"><span class="string">------------</span></span><br><span class="line"><span class="string">Trx id counter 111780536</span></span><br><span class="line"><span class="string">Purge done for trx'</span>s n:o &lt; <span class="number">111780535</span> <span class="keyword">undo</span> n:o &lt; <span class="number">0</span> state: running but idle</span><br><span class="line">History <span class="keyword">list</span> <span class="keyword">length</span> <span class="number">1010</span></span><br><span class="line"><span class="keyword">LIST</span> <span class="keyword">OF</span> TRANSACTIONS <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">SESSION</span>:</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62105</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21aefb700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200464</span> localhost root init</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engine</span> <span class="keyword">innodb</span> <span class="keyword">status</span></span><br><span class="line"><span class="comment">---TRANSACTION 111780476, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62104</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b040700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200100</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780477, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62103</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b081700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200108</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780455, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62102</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b7de700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200015</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780478, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62101</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21afbe700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200115</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780405, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62100</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b289700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200462</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780453, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62099</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21aa28700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200058</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780402, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62095</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21ad75700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200071</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780475, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62098</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b248700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200097</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111779613, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62087</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a186700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117195138</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62083</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b658700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117195026</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111779575, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62076</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b30b700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117194924</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111779456, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62051</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a820700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200379</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111779907, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62073</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21ac30700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200434</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111778722, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62069</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b71b700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117190014</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111777860, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62053</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a7df700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117185336</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62052</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21ad34700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117184909</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111777848, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62050</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a4d3700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117185237</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62049</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff22589f700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117182503</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780530, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62038</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b491700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200458</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780509, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62037</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21ab6d700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200389</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111776792, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62036</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff2257dc700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117180104</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111775519, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62020</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a861700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117172351</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111774683, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62004</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a208700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117167382</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780522, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">62000</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a1c7700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200418</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61998</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a924700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117166732</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780527, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61995</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a71c700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200443</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111774043, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61991</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff2240ba700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117163134</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111774288, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61990</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff22585e700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117164677</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780535, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61910</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a0c3700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200463</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780485, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61905</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21aa69700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200131</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111766303, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61876</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b3ce700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117114984</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111764451, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61873</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a659700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117102360</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111764316, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61870</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21af7d700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117101536</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61869</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a75d700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117101534</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61865</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b5d6700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117100991</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111763282, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61845</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21abef700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117094925</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61832</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff2258e0700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117087126</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111764411, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61819</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a965700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117115441</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 0, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61820</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21acf3700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117115440</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780190, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61805</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21a8e3700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200447</span> <span class="number">218.18</span><span class="number">.156</span><span class="number">.246</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780525, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61594</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21aeba700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200429</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780479, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61372</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21ab2c700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200120</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780482, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">61348</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b617700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200123</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780518, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">54732</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21b1c6700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200402</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">---TRANSACTION 111780484, not started</span></span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">7801</span>, OS <span class="keyword">thread</span> handle <span class="number">0x7ff21afff700</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">117200125</span> iZwz9bopxrlqc7mv1cqc0gZ <span class="number">120.78</span><span class="number">.205</span><span class="number">.38</span> root cleaning up</span><br><span class="line"><span class="comment">--------</span></span><br><span class="line"><span class="keyword">FILE</span> I/O</span><br><span class="line"><span class="comment">--------</span></span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">0</span> state: waiting <span class="keyword">for</span> completed aio requests (<span class="keyword">insert</span> buffer <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">1</span> state: waiting <span class="keyword">for</span> completed aio requests (<span class="keyword">log</span> <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">2</span> state: waiting <span class="keyword">for</span> completed aio requests (<span class="keyword">read</span> <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">3</span> state: waiting <span class="keyword">for</span> completed aio requests (<span class="keyword">read</span> <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">4</span> state: waiting <span class="keyword">for</span> completed aio requests (<span class="keyword">read</span> <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">5</span> state: waiting <span class="keyword">for</span> completed aio requests (<span class="keyword">read</span> <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">6</span> state: waiting <span class="keyword">for</span> completed aio requests (write <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">7</span> state: waiting <span class="keyword">for</span> completed aio requests (write <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">8</span> state: waiting <span class="keyword">for</span> completed aio requests (write <span class="keyword">thread</span>)</span><br><span class="line">I/O <span class="keyword">thread</span> <span class="number">9</span> state: waiting <span class="keyword">for</span> completed aio requests (write <span class="keyword">thread</span>)</span><br><span class="line">Pending <span class="keyword">normal</span> aio <span class="keyword">reads</span>: <span class="number">0</span> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] , aio writes: <span class="number">0</span> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] ,</span><br><span class="line"> ibuf aio <span class="keyword">reads</span>: <span class="number">0</span>, <span class="keyword">log</span> i/o<span class="string">'s: 0, sync i/o'</span>s: <span class="number">0</span></span><br><span class="line">Pending flushes (fsync) <span class="keyword">log</span>: <span class="number">0</span>; buffer pool: 0</span><br><span class="line">8559 OS file reads, 12457384 OS file writes, 6040120 OS fsyncs</span><br><span class="line">0.00 reads/s, 0 avg bytes/read, 4.83 writes/s, 2.78 fsyncs/s</span><br><span class="line"><span class="comment">-------------------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> BUFFER <span class="keyword">AND</span> ADAPTIVE <span class="keyword">HASH</span> <span class="keyword">INDEX</span></span><br><span class="line"><span class="comment">-------------------------------------</span></span><br><span class="line">Ibuf: <span class="keyword">size</span> <span class="number">1</span>, free <span class="keyword">list</span> <span class="keyword">len</span> <span class="number">1895</span>, seg <span class="keyword">size</span> <span class="number">1897</span>, <span class="number">273</span> merges</span><br><span class="line">merged <span class="keyword">operations</span>:</span><br><span class="line"> <span class="keyword">insert</span> <span class="number">1040</span>, <span class="keyword">delete</span> mark <span class="number">0</span>, <span class="keyword">delete</span> <span class="number">0</span></span><br><span class="line">discarded <span class="keyword">operations</span>:</span><br><span class="line"> <span class="keyword">insert</span> <span class="number">0</span>, <span class="keyword">delete</span> mark <span class="number">0</span>, <span class="keyword">delete</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">Hash</span> <span class="keyword">table</span> <span class="keyword">size</span> <span class="number">276707</span>, node <span class="keyword">heap</span> has <span class="number">87</span> buffer(s)</span><br><span class="line"><span class="number">3.83</span> <span class="keyword">hash</span> searches/s, <span class="number">11.61</span> non-<span class="keyword">hash</span> searches/s</span><br><span class="line"><span class="comment">---</span></span><br><span class="line"><span class="keyword">LOG</span></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"><span class="keyword">Log</span> <span class="keyword">sequence</span> <span class="built_in">number</span> <span class="number">8621030500</span></span><br><span class="line"><span class="keyword">Log</span> flushed up <span class="keyword">to</span>   <span class="number">8621030500</span></span><br><span class="line">Pages flushed up <span class="keyword">to</span> <span class="number">8621026316</span></span><br><span class="line"><span class="keyword">Last</span> checkpoint <span class="keyword">at</span>  <span class="number">8621026316</span></span><br><span class="line"><span class="number">0</span> pending <span class="keyword">log</span> writes, <span class="number">0</span> pending chkp writes</span><br><span class="line"><span class="number">2808463</span> <span class="keyword">log</span> i/o<span class="string">'s done, 0.94 log i/o'</span>s/<span class="keyword">second</span></span><br><span class="line"><span class="comment">----------------------</span></span><br><span class="line">BUFFER POOL <span class="keyword">AND</span> <span class="keyword">MEMORY</span></span><br><span class="line"><span class="comment">----------------------</span></span><br><span class="line">Total <span class="keyword">memory</span> allocated <span class="number">137363456</span>; in additional pool allocated 0</span><br><span class="line">Dictionary memory allocated 2267341</span><br><span class="line">Buffer pool size   8192</span><br><span class="line">Free buffers       1024</span><br><span class="line">Database pages     7081</span><br><span class="line">Old database pages 2593</span><br><span class="line">Modified db pages  8</span><br><span class="line">Pending reads 0</span><br><span class="line">Pending writes: LRU 0, <span class="keyword">flush</span> <span class="keyword">list</span> <span class="number">0</span>, single page <span class="number">0</span></span><br><span class="line">Pages made young <span class="number">1680</span>, <span class="keyword">not</span> young <span class="number">124037</span></span><br><span class="line"><span class="number">0.00</span> youngs/s, <span class="number">0.00</span> non-youngs/s</span><br><span class="line">Pages <span class="keyword">read</span> <span class="number">7381</span>, created <span class="number">8238</span>, written <span class="number">8898960</span></span><br><span class="line"><span class="number">0.00</span> <span class="keyword">reads</span>/s, <span class="number">0.00</span> creates/s, <span class="number">3.56</span> writes/s</span><br><span class="line">Buffer pool hit rate <span class="number">1000</span> / <span class="number">1000</span>, young-making rate <span class="number">0</span> / <span class="number">1000</span> <span class="keyword">not</span> <span class="number">0</span> / <span class="number">1000</span></span><br><span class="line">Pages <span class="keyword">read</span> ahead <span class="number">0.00</span>/s, evicted <span class="keyword">without</span> <span class="keyword">access</span> <span class="number">0.00</span>/s, Random <span class="keyword">read</span> ahead <span class="number">0.00</span>/s</span><br><span class="line">LRU <span class="keyword">len</span>: <span class="number">7081</span>, unzip_LRU <span class="keyword">len</span>: <span class="number">0</span></span><br><span class="line">I/O <span class="keyword">sum</span>[<span class="number">308</span>]:cur[<span class="number">0</span>], unzip <span class="keyword">sum</span>[<span class="number">0</span>]:cur[<span class="number">0</span>]</span><br><span class="line"><span class="comment">--------------</span></span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">OPERATIONS</span></span><br><span class="line"><span class="comment">--------------</span></span><br><span class="line"><span class="number">0</span> queries inside <span class="keyword">InnoDB</span>, <span class="number">0</span> queries <span class="keyword">in</span> queue</span><br><span class="line"><span class="number">0</span> <span class="keyword">read</span> views <span class="keyword">open</span> inside <span class="keyword">InnoDB</span></span><br><span class="line"><span class="keyword">Main</span> <span class="keyword">thread</span> process no. <span class="number">29403</span>, <span class="keyword">id</span> <span class="number">140677885191936</span>, state: sleeping</span><br><span class="line"><span class="built_in">Number</span> <span class="keyword">of</span> <span class="keyword">rows</span> inserted <span class="number">2324850</span>, <span class="keyword">updated</span> <span class="number">1008701</span>, deleted <span class="number">739761</span>, <span class="keyword">read</span> <span class="number">9221107060</span></span><br><span class="line"><span class="number">0.67</span> inserts/s, <span class="number">0.28</span> updates/s, <span class="number">0.00</span> deletes/s, <span class="number">245.54</span> <span class="keyword">reads</span>/s</span><br><span class="line"><span class="comment">----------------------------</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">OF</span> <span class="keyword">INNODB</span> MONITOR <span class="keyword">OUTPUT</span></span><br><span class="line">============================</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">ERROR</span>: </span><br><span class="line"><span class="keyword">No</span> <span class="keyword">query</span> specified</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>定位到LATEST DETECTED DEADLOCK 我们发现有存在事务锁，同一时间存在排他锁跟共享锁</li>
<li><p>原先代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//设置batch</span></span><br><span class="line">String batch = RandomUtil.generateNumber6();</span><br><span class="line">ecps.forEach(ecp -&gt; ecp.setBatch(batch));</span><br><span class="line"><span class="comment">//新增</span></span><br><span class="line"><span class="keyword">int</span> count = accountYxtEcpMapper.insertBatch(ecps);</span><br><span class="line"><span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">    log.info(<span class="string">"重复添加,ecps=&#123;&#125;"</span>, JSON.toJSONString(ecps));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">List&lt;AccountYxtEcp&gt; needToAdd = ecps;</span><br><span class="line">AccountYxtEcp ecp = ecps.get(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//存在重复情况</span></span><br><span class="line"><span class="keyword">if</span> (count != ecps.size()) &#123;</span><br><span class="line">    needToAdd = accountYxtEcpMapper.ecpsByBatch(</span><br><span class="line">            ecp.getBid(),</span><br><span class="line">            ecp.getDay(),</span><br><span class="line">            ecp.getBatch(),</span><br><span class="line">            ecps.stream().map(AccountYxtEcp::getUid).collect(toList()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (CollectionUtils.isEmpty(needToAdd)) &#123;</span><br><span class="line">    log.info(<span class="string">"重复添加,ecps=&#123;&#125;"</span>, JSON.toJSONString(ecps));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (needToAdd.size() != ecps.size()) &#123;</span><br><span class="line">    log.info(<span class="string">"存在部分重复不重复部分,ecps=&#123;&#125;"</span>, JSON.toJSONString(ecps));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (AccountYxtEcp yxtEcp : needToAdd) &#123;</span><br><span class="line">    <span class="keyword">this</span>.addTradeDetail(yxtEcp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改程序代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AccountYxtEcp&gt; needAddAccountYxtEcp = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//设置batch</span></span><br><span class="line">String batch = RandomUtil.generateNumber6();</span><br><span class="line">log.info(<span class="string">"过滤前ecps=&#123;&#125;"</span>,JSON.toJSONString(ecps));</span><br><span class="line">ecps.stream().filter(distinctByKey(AccountYxtEcp::getUid));</span><br><span class="line">AccountYxtEcp ecp = ecps.get(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//查询到当天已经插入的批次</span></span><br><span class="line">List&lt;AccountYxtEcp&gt; accountYxtEcps = accountYxtEcpMapper.ecpsByDay(ecp.getBid(),ecp.getDay());</span><br><span class="line"><span class="keyword">if</span> (CollectionUtil.isEmpty(accountYxtEcps))&#123;</span><br><span class="line">    log.info(<span class="string">"当前暂时还没有插入数据"</span>);</span><br><span class="line">    needAddAccountYxtEcp = ecps;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//判断当前是否已经有交集</span></span><br><span class="line">    accountYxtEcps.retainAll(ecps);</span><br><span class="line">    <span class="keyword">if</span> (accountYxtEcps.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        log.info(<span class="string">"有交集"</span>);</span><br><span class="line">        needAddAccountYxtEcp = ecps.stream()</span><br><span class="line">                .filter(s-&gt;!accountYxtEcps.stream().map(accountYxtEcp -&gt; accountYxtEcp.getUid()).collect(Collectors.toList()).contains(s.getUid()))</span><br><span class="line">                .collect(Collectors.toList()) ;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        needAddAccountYxtEcp = ecps;</span><br><span class="line">        log.info(<span class="string">"没有交集,那么便利重新插入数据"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">needAddAccountYxtEcp.forEach(accountYxtEcp -&gt; accountYxtEcp.setBatch(batch));</span><br><span class="line"><span class="comment">//新增</span></span><br><span class="line">accountYxtEcpMapper.insertBatch(needAddAccountYxtEcp);</span><br><span class="line"><span class="keyword">for</span> (AccountYxtEcp yxtEcp : needAddAccountYxtEcp) &#123;</span><br><span class="line">    <span class="keyword">this</span>.addTradeDetail(yxtEcp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/07/记一次MySQL死锁问题/" data-id="cjkp8jblm000lo4qfxybg14xi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-自定义git触发编译脚本" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/20/自定义git触发编译脚本/" class="article-date">
  <time datetime="2018-06-20T03:03:06.000Z" itemprop="datePublished">2018-06-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/20/自定义git触发编译脚本/">自定义git触发编译脚本</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.通过 gitee push之后触发事件，执行WebHooks请求到我们设置的地址<br>2.在设置请求的地址里面判断当前commit里面是否包含某个”需要自动化编译的标示”，如果包含的话执行Linux上面的脚本编译自动部署项目<br>eg: 例子上面给出的是判断当前commit里面是否包含10086，如果包含的话执行Linux脚本<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/common/run"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">run</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span>  ParseException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;String&gt; jsonList = org.apache.commons.io.IOUtils.readLines(request.getInputStream());</span><br><span class="line">        <span class="keyword">if</span> (Objects.nonNull(jsonList) &amp;&amp; jsonList.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            StringBuilder jsonBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            jsonList.forEach(str-&gt;&#123;</span><br><span class="line">                jsonBuilder.append(str);</span><br><span class="line">            &#125;);</span><br><span class="line">            JSONObject jsonObject = JSON.parseObject(jsonBuilder.toString());</span><br><span class="line">            JSONArray commitsJSONArray = (JSONArray)jsonObject.get(<span class="string">"commits"</span>);</span><br><span class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,length = commitsJSONArray.size();i&lt;length;i++)&#123;</span><br><span class="line">                JSONObject  childJSONObject = (JSONObject) commitsJSONArray.get(i);</span><br><span class="line">                String message = (String) childJSONObject.get(<span class="string">"message"</span>);</span><br><span class="line">                log.info(<span class="string">"获取到commit里面的消息 &#123;&#125;"</span>,message);</span><br><span class="line">                <span class="keyword">if</span> (message.contains(<span class="string">"10086"</span>))&#123;</span><br><span class="line">                    flag = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(<span class="string">"flag的值&#123;&#125;"</span>,flag);</span><br><span class="line">            <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">                process(<span class="keyword">new</span> String[]&#123;<span class="string">"sh"</span>,<span class="string">"/root/run.sh"</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">        throwable.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="string">"执行完毕"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  调用脚本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> cmdArray</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String[] cmdArray)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    ProcessBuilder pb = <span class="keyword">new</span> ProcessBuilder(cmdArray);</span><br><span class="line">    pb.redirectErrorStream(<span class="keyword">true</span>);</span><br><span class="line">    Process p = <span class="keyword">null</span>;</span><br><span class="line">    BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        p = pb.start();</span><br><span class="line">        br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(p.getInputStream()));</span><br><span class="line">        String line = <span class="keyword">null</span>;</span><br><span class="line">        log.info(<span class="string">"Invoke shell: &#123;&#125;"</span>, StringUtils.join(cmdArray, <span class="string">" "</span>));</span><br><span class="line">        <span class="keyword">while</span> ((line = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.info(line);</span><br><span class="line">        &#125;</span><br><span class="line">        p.waitFor();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (br != <span class="keyword">null</span>) &#123;</span><br><span class="line">            br.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">            p.destroy();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/git_自定义_push.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/20/自定义git触发编译脚本/" data-id="cjkp8jblk000ho4qf4o34ptuq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Linux各种命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/29/Linux各种命令/" class="article-date">
  <time datetime="2018-04-29T14:59:14.000Z" itemprop="datePublished">2018-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/29/Linux各种命令/">Linux各种命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.按进程消耗内存多少排序的方法，查看占据内存最大的前10个进程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -e -o &apos;pid,comm,args,pcpu,rsz,vsz,stime,user,uid&apos; --sort -rsz|head -11</span><br></pre></td></tr></table></figure></p>
<p>2.vmstat 1 查看CPU消耗<br>3.kill掉对应关键字的线程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep 查询关键字 |grep -v grep|cut  -c 9-15|xargs kill -9</span><br></pre></td></tr></table></figure></p>
<p>4.通过pid查看占用端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nap|grep 进程PID</span><br></pre></td></tr></table></figure></p>
<p>5.通过端口查看占用进程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -nap|grep 端口号</span><br><span class="line">备注：windows下查看端口占用</span><br><span class="line">如:查询占用了8080端口的进程：netstat -ano|findstr &quot;8080&quot;</span><br></pre></td></tr></table></figure></p>
<p>6.mvn 编译过慢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -T 1C -Dmaven.test.skip=true  -Dmaven.compile.fork=true</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/29/Linux各种命令/" data-id="cjkp8jble000ao4qf6v2s9p9s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CentOS7使用mailx发送邮件-通过postfix与mailx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/29/CentOS7使用mailx发送邮件-通过postfix与mailx/" class="article-date">
  <time datetime="2018-04-29T14:55:08.000Z" itemprop="datePublished">2018-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/29/CentOS7使用mailx发送邮件-通过postfix与mailx/">CentOS7使用mailx发送邮件(通过postfix与mailx)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.先卸载掉sendmail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove -y sendmail</span><br></pre></td></tr></table></figure></p>
<p>2.安装postdix<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y postfix mailx cyrus-sasl-plain</span><br></pre></td></tr></table></figure></p>
<p>3.这里我们使用163邮箱来发送邮件，首先到163邮箱官网里面设置smtp还有获取授权码<br><img src="/images/mailxsend.png" alt=""><br>4.编辑vim /etc/mail.rc,编辑内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set from=（发送人）</span><br><span class="line">set smtp=(发送邮件的stmp)smtps://smtp.163.com:994</span><br><span class="line">set smtp-auth=login</span><br><span class="line">set smtp-auth-user=(用户名)</span><br><span class="line">set smtp-auth-password=(授权码)</span><br><span class="line">set ssl-verify=ignore</span><br><span class="line">set nss-config-dir=/etc/pki/nssdb</span><br></pre></td></tr></table></figure></p>
<p>5.测试发送<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo “内容” | mailx -v -s &quot; 标题&quot; 收件人邮箱</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/29/CentOS7使用mailx发送邮件-通过postfix与mailx/" data-id="cjkp8jbl00000o4qfwwn9ugjj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shell/">Shell</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-图片服务器Fastdfs配置nginx缩略图" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/29/图片服务器Fastdfs配置nginx缩略图/" class="article-date">
  <time datetime="2018-04-29T14:46:25.000Z" itemprop="datePublished">2018-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/29/图片服务器Fastdfs配置nginx缩略图/">图片服务器Fastdfs配置nginx缩略图</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.下载并安装FastDFS依赖包libfastcommon<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://codeload.github.com/happyfish100/libfastcommon/zip/master</span><br><span class="line">unzip master</span><br><span class="line">cd libfastcommon-master/</span><br><span class="line">./make.sh</span><br><span class="line">./make.sh install</span><br></pre></td></tr></table></figure></p>
<p>2.下载并安装FastDFS<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/happyfish100/fastdfs/archive/V5.11.tar.gz</span><br><span class="line">tar xf V5.11.tar.gz</span><br><span class="line">cd fastdfs-5.11</span><br><span class="line"> ./make.sh &amp;&amp; ./make.sh install</span><br></pre></td></tr></table></figure></p>
<p>3.配置跟踪服务器（tracker server）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1）拷贝tracker server和client端样例配置文件并重命名</span><br><span class="line">cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf</span><br><span class="line">cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf</span><br><span class="line">2）编辑tracker server配置文件tracker.conf，需要修改内容如下：</span><br><span class="line">disabled=false（默认为false，表示是否无效）</span><br><span class="line">port=22122（默认为22122）</span><br><span class="line">base_path=/home/fastdfs/tracker</span><br><span class="line">3）编辑client端的配置文件client.conf，需要修改内容如下</span><br><span class="line"> base_path=/home/fastdfs/tracker</span><br><span class="line"> tracker_server=192.168.1.147:22122</span><br><span class="line">4）创建tracker server数据目录</span><br><span class="line">mkdir -p /home/fastdfs/tracker</span><br><span class="line">5）测试启动tracker server，启动成功会自动在/home/fastdfs/tracker目录新建data和logs目录</span><br><span class="line">/etc/init.d/fdfs_trackerd start</span><br><span class="line">6）关闭tracker server</span><br></pre></td></tr></table></figure></p>
<p>4、配置存储服务器（storage server）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1）拷贝storage server样例配置文件并重命名</span><br><span class="line">cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf</span><br><span class="line">2）编辑storage server配置文件storage.conf，需要修改内容如下：</span><br><span class="line">disabled=false（默认为false，表示是否无效）</span><br><span class="line">port=23000（默认为23000）</span><br><span class="line">base_path=/home/fastdfs/storage</span><br><span class="line">tracker_server=192.168.1.147:22122</span><br><span class="line">store_path0=/home/fastdfs/storage</span><br><span class="line">http.server_port=8888（默认为8888，nginx中配置的监听端口那之一致）</span><br><span class="line">3）创建storage server数据目录</span><br><span class="line">mkdir -p /home/fastdfs/storage</span><br><span class="line">4）测试启动storage server，启动成功会自动在/data/fastdfs/tracker目录新建data和logs目录（启动storage server的前提是tracker server必须事先已启动）</span><br><span class="line">/etc/init.d/fdfs_storaged start</span><br></pre></td></tr></table></figure></p>
<p>5、文件上传测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">执行如下上传命令： fdfs_upload_file /etc/fdfs/client.conf  login.jpg</span><br><span class="line">group1/M00/00/00/wKgBk1nd1ImAJ7MiAAJwztHvyoo346.jpg</span><br></pre></td></tr></table></figure></p>
<p>5.存储服务器（storage server）安装并配置nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">1).下载fastdfs-nginx-module模块	</span><br><span class="line">2）拷贝fastdfs-nginx-module模块中配置文件到/etc/fdfs目录中并编辑</span><br><span class="line">cp /root/fastdfs-nginx-module-master/src/mod_fastdfs.conf /etc/fdfs/</span><br><span class="line">vim /etc/fdfs/mod_fastdfs.conf</span><br><span class="line">修改内容如下：</span><br><span class="line">connect_timeout=10</span><br><span class="line">base_path=/tmp（默认为/tmp）</span><br><span class="line">tracker_server=192.168.1.147:22122</span><br><span class="line">storage_server_port=23000（默认配置为23000）</span><br><span class="line">url_have_group_name = true</span><br><span class="line">store_path0=/home/fastdfs/storage</span><br><span class="line">group_name=group1（默认配置为group1）</span><br><span class="line">3）安装nginx依赖库</span><br><span class="line">yum install -y pcre-devel zlib-devel  gd-devel</span><br><span class="line">4）下载并安装nginx</span><br><span class="line">wget https://nginx.org/download/nginx-1.12.1.tar.gz</span><br><span class="line">tar -zxf nginx-1.12.1.tar.gz</span><br><span class="line">cd nginx-1.12.1</span><br><span class="line">./configure --prefix=/application/nginx/ --add-module=../fastdfs-nginx-module-master/src/ --with-http_image_filter_module</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">5）拷贝FastDFS中的部分配置文件到/etc/fdfs目录中</span><br><span class="line">cp  /root/fastdfs-5.11/conf/http.conf  /etc/fdfs/</span><br><span class="line">cp  /root/fastdfs-5.11/conf/mime.types  /etc/fdfs/</span><br><span class="line">6）配置nginx，如下所示：vim /application/nginx/conf/nginx.conf</span><br><span class="line"> user  root;    </span><br><span class="line">        worker_processes  1;</span><br><span class="line"> events &#123;</span><br><span class="line">       worker_connections  1024;</span><br><span class="line"> &#125;</span><br><span class="line">   	http &#123;</span><br><span class="line">        include       mime.types;</span><br><span class="line">        default_type  application/octet-stream;</span><br><span class="line">        sendfile        on;</span><br><span class="line">        keepalive_timeout  65;</span><br><span class="line">        server &#123;</span><br><span class="line">            listen       8888;</span><br><span class="line">            server_name  localhost;</span><br><span class="line">            </span><br><span class="line">     location ~/group[0-9]/M[0-1][0-9]/.*,([0-9]+)x([0-9]+)\.(jpg|png|gif)$ &#123;</span><br><span class="line">            alias /home/fastdfs/storage/data;</span><br><span class="line">            ngx_fastdfs_module;</span><br><span class="line">            set $img_width2 $1;</span><br><span class="line">            set $img_height2 $2;</span><br><span class="line">            rewrite ^(.*),[0-9]+x[0-9]+\.(jpg|png|gif)$ $1.$2  break;</span><br><span class="line">            image_filter resize  $img_width2   $img_height2;</span><br><span class="line">     &#125;</span><br><span class="line">     location ~/group[0-9]/M[0-1][0-9]/(.*)&#123;</span><br><span class="line">            alias /home/fastdfs/storage/data;</span><br><span class="line">            ngx_fastdfs_module;</span><br><span class="line">     &#125;</span><br><span class="line">            error_page   500 502 503 504  /50x.html;</span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">            	root   html;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>7）拷贝nginx服务到/etc/init.d/目录下并启动</p>
<pre><code>cp /application/nginx/sbin/nginx /etc/init.d/
/etc/init.d/nginx
</code></pre><p>8).通过浏览器访问</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/29/图片服务器Fastdfs配置nginx缩略图/" data-id="cjkp8jbll000jo4qfh8z8f91v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fastdfs/">Fastdfs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CentOS7安装MySQL5-7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/29/CentOS7安装MySQL5-7/" class="article-date">
  <time datetime="2018-04-29T14:25:20.000Z" itemprop="datePublished">2018-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/29/CentOS7安装MySQL5-7/">CentOS7安装MySQL5.7</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.添加 mysql yum Repository<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="comment">//dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span></span><br><span class="line">yum localinstall mysql57-community-release-el7-<span class="number">11</span>.noarch.rpm</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li><p>安装mysql-server:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>mysql服务 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a).启动mysql服务:service mysqld start </span><br><span class="line">b).查看mysql服务状态:service mysqld status</span><br><span class="line">c).重启mysql服务: service mysqld restart</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>4.修改初始密码<br>a).初始密码在 /var/log/mysqld.log 文件中<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'temporary password'</span> /var/log/mysqld.log</span><br></pre></td></tr></table></figure></p>
<p>5.修改 root 密码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a ). mysql -u root -p </span><br><span class="line">b ). ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'1qaz@WSX3edc'</span>;  </span><br><span class="line">c ). FLUSH PRIVILEGES;</span><br><span class="line">d). exit;</span><br></pre></td></tr></table></figure></p>
<p>6.重启mysql<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure></p>
<p>7.设置 mysql 远程访问<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a). vim /etc/my.cnf 增加内容：bind-address = <span class="number">0.0</span>.0.0</span><br><span class="line">b). 增加慢查询</span><br><span class="line">slow-query-log = <span class="number">1</span></span><br><span class="line">slow-query-log-file=/var/lib/mysql/mysql_slow.log</span><br><span class="line">long_query_time=<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>8.登录 mysql -u root -p<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; select user,host from user;</span><br><span class="line">将root用户host更新成 %:</span><br><span class="line">mysql&gt;  update user set host = <span class="string">'%'</span> where user = <span class="string">'root'</span>;</span><br></pre></td></tr></table></figure></p>
<p>9.重启mysql<br>10.查看慢查询参数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'%query%'</span>;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/29/CentOS7安装MySQL5-7/" data-id="cjkp8jblb0007o4qfqyqvpz6f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CenOS7部署Gitblit-push触发HOOK" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/29/CenOS7部署Gitblit-push触发HOOK/" class="article-date">
  <time datetime="2018-04-29T13:56:42.000Z" itemprop="datePublished">2018-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/29/CenOS7部署Gitblit-push触发HOOK/">CenOS7部署Gitblit,push触发HOOK</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.首先到<a href="http://gitblit.com/" target="_blank" rel="noopener">http://gitblit.com/</a> 下载gitblit文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;cd /usr/local/src</span><br><span class="line">&gt;wget http://dl.bintray.com/gitblit/releases/gitblit-1.8.0.tar.gz</span><br><span class="line">&gt;tar -zxf gitblit-1.8.0.tar.gz gitblit-1.8.0</span><br><span class="line">&gt; mv gitblit-1.8.0 gitblit</span><br></pre></td></tr></table></figure></p>
<p>2.由于gitblit是使用Groovy语言开发的，所以需要JAVA_HOME，需要先提前配置好JAVA_HOME环境变量<br>3.配置gitblit git仓库，跟web端口号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;cd data</span><br><span class="line">&gt;vim defaults.properties</span><br></pre></td></tr></table></figure></p>
<p>4.找到server.httpPort ,git.repositoriesFolder,修改成对应的地址<br>5.执行gitblit方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;cd gitblit </span><br><span class="line">&gt;./gitblit.sh</span><br></pre></td></tr></table></figure></p>
<p>6.gitblit默认账号密码是admin，创建版本库。<br>7.编辑hook触发脚本文件,编辑内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;cd groovy</span><br><span class="line">&gt;vim auto.groovy</span><br></pre></td></tr></table></figure></p>
<p>#内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import com.gitblit.GitBlit</span><br><span class="line">import com.gitblit.Keys</span><br><span class="line">import com.gitblit.models.RepositoryModel</span><br><span class="line">import com.gitblit.models.TeamModel</span><br><span class="line">import com.gitblit.models.UserModel</span><br><span class="line">import com.gitblit.utils.JGitUtils</span><br><span class="line">import com.gitblit.utils.StringUtils</span><br><span class="line">import java.text.SimpleDateFormat</span><br><span class="line">import org.eclipse.jgit.api.CloneCommand</span><br><span class="line">import org.eclipse.jgit.api.Git</span><br><span class="line">import org.eclipse.jgit.lib.Repository</span><br><span class="line">import org.eclipse.jgit.lib.Config</span><br><span class="line">import org.eclipse.jgit.revwalk.RevCommit</span><br><span class="line">import org.eclipse.jgit.transport.ReceiveCommand</span><br><span class="line">import org.eclipse.jgit.transport.ReceiveCommand.Result</span><br><span class="line">import org.eclipse.jgit.util.FileUtils</span><br><span class="line">import org.slf4j.Logger</span><br><span class="line">import org.eclipse.jgit.api.ResetCommand.ResetType</span><br><span class="line">import org.eclipse.jgit.api.ResetCommand</span><br><span class="line"></span><br><span class="line">logger.info(&quot;localclone hook triggered by $&#123;user.username&#125; for $&#123;repository.name&#125;&quot;)</span><br><span class="line"></span><br><span class="line">def rootFolder = &apos;/usr/local/nginx/html&apos;</span><br><span class="line">def bare = false</span><br><span class="line">def cloneAllBranches = true</span><br><span class="line">def cloneBranch = &apos;refs/heads/master&apos;</span><br><span class="line">def includeSubmodules = true</span><br><span class="line"></span><br><span class="line">def repoName = repository.name</span><br><span class="line">def destinationFolder = new File(rootFolder, StringUtils.stripDotGit(repoName))</span><br><span class="line">def srcUrl = &apos;file://&apos; + new File(gitblit.getRepositoriesFolder(), repoName).absolutePath</span><br><span class="line"></span><br><span class="line">// delete any previous clone</span><br><span class="line">if (destinationFolder.exists()) &#123;</span><br><span class="line">	Git git = Git.open(destinationFolder)</span><br><span class="line">    git.fetch().call()</span><br><span class="line">    logger.info(&quot;执行git fetch&quot;)</span><br><span class="line">    ResetCommand resetCmd = git.reset()</span><br><span class="line">    resetCmd.setMode(ResetType.HARD)</span><br><span class="line">    resetCmd.setRef(&quot;FETCH_HEAD&quot;) </span><br><span class="line">    resetCmd.call()</span><br><span class="line">	logger.info(&quot;执行git reset&quot;)</span><br><span class="line">	git.pull().call()</span><br><span class="line">	logger.info(&quot;执行git pull强制同步服务器结束！&quot;)</span><br><span class="line">	//FileUtils.delete(destinationFolder, FileUtils.RECURSIVE)</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	// clone the repository</span><br><span class="line">	logger.info(&quot;cloning $&#123;srcUrl&#125; to $&#123;destinationFolder&#125;&quot;)</span><br><span class="line">	CloneCommand cmd = Git.cloneRepository();</span><br><span class="line">	cmd.setBare(bare)</span><br><span class="line">	if (cloneAllBranches)</span><br><span class="line">		cmd.setCloneAllBranches(true)</span><br><span class="line">	else</span><br><span class="line">		cmd.setBranch(cloneBranch)</span><br><span class="line">	cmd.setCloneSubmodules(includeSubmodules)</span><br><span class="line">	cmd.setURI(srcUrl)</span><br><span class="line">	cmd.setDirectory(destinationFolder)</span><br><span class="line">	Git git = cmd.call();</span><br><span class="line">	git.repository.close()</span><br><span class="line">	// report clone operation success back to pushing Git client</span><br><span class="line">	clientLogger.info(&quot;$&#123;repoName&#125; cloned to $&#123;destinationFolder&#125;&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>8.编辑版本库，配置我们刚才编写的groovy文件<br><img src="/images/clipboard.png" alt=""><br>9.配置SSH ，避免需要输入密码</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/29/CenOS7部署Gitblit-push触发HOOK/" data-id="cjkp8jbl40001o4qfp8hc1b6u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Gitblit/">Gitblit</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-spring-boot集成kafka发送消息" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/29/spring-boot集成kafka发送消息/" class="article-date">
  <time datetime="2018-04-29T13:52:26.000Z" itemprop="datePublished">2018-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/29/spring-boot集成kafka发送消息/">spring-boot集成kafka发送消息</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.引入spring-kafka.jar文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>2.在application.yml里面加入kafka配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">    kafka:</span><br><span class="line">        bootstrap-servers: 192.168.1.90:9092</span><br></pre></td></tr></table></figure></p>
<p>3.引入KafkaTemplate ，发送消息使用kafkaTemplate.send(“test”, “bootcwnao”, JSON.toJSONString(data));</p>
<p>备注：<br>1.启动脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup bin/zookeeper-server-start.sh config/zookeeper.properties &gt; zookeeper.log 2&gt;&amp;1 &amp;</span><br><span class="line">nohup bin/kafka-server-start.sh config/server.properties &gt; kafka.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></p>
<p>2.注意kafka是否开放了host,port端口<br>修改server.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">advertised.listeners=PLAINTEXT://192.168.1.90:9092</span><br></pre></td></tr></table></figure></p>
<p>2.查看消息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh --bootstrap-server 192.168.1.90:9092 --topic test  --from-beginning</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/29/spring-boot集成kafka发送消息/" data-id="cjkp8jblf000co4qfuzjai9yi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kafka/">kafka</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fastdfs/">Fastdfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gitblit/">Gitblit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java虚拟机/">Java虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSA加密/">RSA加密</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Fastdfs/" style="font-size: 10px;">Fastdfs</a> <a href="/tags/Gitblit/" style="font-size: 10px;">Gitblit</a> <a href="/tags/Java/" style="font-size: 16.67px;">Java</a> <a href="/tags/Java虚拟机/" style="font-size: 10px;">Java虚拟机</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/RSA加密/" style="font-size: 10px;">RSA加密</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Shell/" style="font-size: 13.33px;">Shell</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/09/深入理解HashMap/">深入理解HashMap</a>
          </li>
        
          <li>
            <a href="/2018/07/29/Java虚拟机命令/">Java虚拟机命令</a>
          </li>
        
          <li>
            <a href="/2018/07/07/记一次MySQL死锁问题/">记一次MySQL死锁问题</a>
          </li>
        
          <li>
            <a href="/2018/06/20/自定义git触发编译脚本/">自定义git触发编译脚本</a>
          </li>
        
          <li>
            <a href="/2018/04/29/Linux各种命令/">Linux各种命令</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 刘顺秋<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>